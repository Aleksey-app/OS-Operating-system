# Практическая работа №5
**Знакомство со средством синхронизации процессов - именованными семафорами и с системными вызовами, обеспечивающими создание, открытие, закрытие и удаление именованных семафоров, а также захват и освобождение именованных семафоров.**
>Написать программу, содержащую две программы, осуществляющих координированный доступ к разделяемому ресурсу. Необходимо выбрать общий ресурс – файл и осуществлять запись данных в него из двух программ.

   **В стандарте POSIX именованный семафор создается следующим вызовом:**
     
```c
sem_t *sem_open(const char *name, int oflag, mode_t mode, unsigned int value)
```
- Где: name – имя семафора;
- oflag – флаг, управляющий операцией создания семафора;

    |Флаг|Описание|
    |:---|:------:|
    |O_CREAT|Cемафор создаётся, если ещё не существует. Владельцем (ID пользователя) семафора устанавливается эффективный ID пользователя вызывающего процесса|
- mode – права доступа к семафору;

    |Флаг|Символьные константы, используемые в mode|
    |:---|:---------------------------------------:|
    |S_IRWXU|00700 пользователь (владелец файла) имеет права на чтение, запись и выполнение файла|
    |S_IRUSR|00400 пользователь имеет права на чтение файла|
    |S_IWUSR|00200 пользователь имеет права на запись в файл|
    |S_IXUSR|00100 пользователь имеет права на выполнение файла|
    |S_IRWXG|00070 группа имеет права на чтение, запись и выполнение файла|
    |S_IRGRP|00040 группа имеет права на чтение файла|
    |S_IWGRP|00020 группа имеет права на запись в файл|
    |S_IXGRP|00010 группа имеет права на выполнение файла|
    |S_IRWXO|00007 все остальные имеют права на чтение, запись и выполнение файла|
    |S_IROTH|00004 все остальные имеют права на чтение файла|
    |S_IWOTH|00002 все остальные имеют права на запись в файл|
    |S_IXOTH|00001 все остальные имеют права на выполнение файла|
- value –	начальное состояние семафора.
1. Реально надо написать одну программу, скопировать ее с другим именем и поменять в ней запись символа ‘1’ на запись символа ‘2’.
- Каждая программа запускается в отдельном терминале.
- Но для наблюдения за работой программ в каждой программе необходимо сделать вывод символа не только в файл, но и на экран своего терминала.

      Для наблюдения за записью в файл надо открыть третий терминал и ввести в нем следующую команду:
      tail –f filename. Где filename – это имя файла, в который вы пишете символы.
2. Обе программы должны создать (или открыть, если создан) один и тот же именованный семафор, должны создать (или открыть, если создан) один и тот же файл, но записывать в файл разные символы.

      ```В двух разных программах семафор становится общим, если у него одинаковое имя – первый параметр функции sem_open(). Обратите внимание на требование к имени семафора – оно должно быть в форме /somename, т.е. первый символ - слэш.```
- Необходимо убедиться, что в случае отсутствия именованного семафора процессы выводят символы в файл в произвольном порядке, например, так:

### 121212121212121212121212121212121212121212121212121212
- В случае использования именованного семафора процессы выводят символы в файл в определенном порядке, например, так:
### 111111111122222222221111111111222222222211111111112222
- Поскольку в этой работе мы используем семафорную операцию ```sem_wait()```(с блокировкой), то при завершении одной программы вторая может зависнуть в этой операции. Выходом из такой ситуации является аварийное завершение программы (ctrl + с). В этом случае семафор может оказаться не удалённым и, более того, может оказаться в запертом состоянии. Тогда повторно запустить программу не удастся. В ОС Linux семафоры – это файлы в каталоге /dev/shm. Вы можете войти в этот каталог и вручную удалить семафор.

**При реализации задания необходимо реализовать программу с потоками.**
- Это когда цикл записи символа в файл и на экран помещен в отдельный поток. Функция getchar() в main() выполняется с блокировкой, а поток создается в единственном экземпляре. Поскольку поток один, то появляется закономерный вопрос – может быть он вообще не нужен. Строго говоря, их два – один работает, другой следит за нажатием клавиши.
